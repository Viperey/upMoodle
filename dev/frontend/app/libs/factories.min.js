angular.module("upmApp").factory("api",function($http){var base_url="http://127.0.0.1:8000/",user_pics_url=base_url+"media/";return{getPic:function(url){return user_pics_url+url},getUser:function(){return $http({method:"GET",url:base_url+"user/"})},updateUserSubjects:function(subjects){return $http({method:"post",url:base_url+"user/subjects/",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")},data:{ids:subjects||[]}})},updateUser:function(user){return $http({method:"POST",url:base_url+"user/",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")},data:user.password?{email:user.email,name:user.name,nick:user.nick,password:user.password}:{email:user.email,name:user.name,nick:user.nick}})},login:function(userEmail,userPassword){return $http({method:"post",url:base_url+"login/",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")},data:{email:userEmail,password:userPassword}})},signup:function(email,password,nick){return $http({method:"post",url:base_url+"signup/",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")},data:{email:email,password:password,nick:nick}})},logout:function(){return $http({method:"POST",url:base_url+"logout/"})},recoverPassword:function(email){return $http({method:"POST",url:base_url+"recover_password/",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")},data:{email:email}})},confirmEmail:function(token){return $http({method:"GET",url:base_url+"confirm_email/"+token+"/"})},subjectsTree:function(){return $http({method:"GET",url:base_url+"subjectsTree/"})},notesByLevelId:function(level,recursive){return $http({method:"GET",url:base_url+"note/level/"+level+"/?recursive="+recursive})},notePost:function(note){return $http({method:"post",url:base_url+"note/",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")},data:{text:note.text,topic:note.topic,level_id:note.level_id}})}}}),angular.module("upmApp").factory("User",["$location","api",function($location,api){var returno={model:void 0,destroy:function(){returno.model=void 0},get:function(){return void 0===this.model?api.getUser().then(function(response){return returno.model=response.data,returno.model},function(){return $location.path("/login"),!1}):this.model},set:function(model){this.model=model},isSignedInSubject:function(id){return returno=!1,angular.forEach(this.model.subjects,function(value){value.id===id&&(returno=!0)}),returno}};return returno}]);